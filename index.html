<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì˜ë‹¨ì–´ ë§ˆìŠ¤í„° í€´ì¦ˆ</title>

<style>
  body { font-family: 'Malgun Gothic', sans-serif; padding: 20px; line-height: 1.6; background-color: #f9f9f9; }
  .pos { color: #0070c0; font-weight: bold; margin-right: 4px; }
  .choice-btn { 
    margin-bottom: 12px; padding: 15px 20px; width: 100%; text-align: left; 
    cursor: pointer; background-color: #fff; border: 1px solid #ddd; border-radius: 8px;
    font-size: 1rem; transition: all 0.2s;
  }
  .choice-btn:hover { background-color: #f0f7ff; border-color: #0070c0; transform: translateY(-1px); }
  .quiz-box { 
    border: 2px solid #0070c0; padding: 30px; border-radius: 12px; 
    background-color: #fff; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 30px;
  }
  #quizWord { 
    font-size: 2rem; font-weight: bold; display: block;
    margin-bottom: 40px; color: #2c3e50; text-align: center;
  }
  .note-container { border: 1px solid #ccc; padding: 15px; margin-top: 10px; max-height: 400px; overflow-y: auto; background-color: #fff; border-radius: 8px; }
  button.count-btn { padding: 10px 18px; margin-right: 8px; cursor: pointer; border-radius: 6px; border: 1px solid #0070c0; background: #fff; color: #0070c0; font-weight: bold; }
  button.count-btn:hover { background: #0070c0; color: #fff; }
  #progress { font-size: 1.1rem; margin-bottom: 15px; color: #333; font-weight: bold; }
</style>

<script>
let WORDS = [];
let remainingWords = [];
let quizList = [];
let currentIndex = 0;   // ì´ë²ˆ íŒì˜ ì¸ë±ìŠ¤
let totalSolved = 0;    // ì§€ê¸ˆê¹Œì§€ ëˆ„ì ìœ¼ë¡œ í‘¼ ë¬¸ì œ ìˆ˜
let totalTarget = 0;    // ì´ë²ˆ ì„¸ì…˜ì—ì„œ ëª©í‘œë¡œ ì¡ì€ ì´ ë¬¸ì œ ìˆ˜

function getCombinedMeanings(meanings) {
  const group = {};
  meanings.forEach(m => {
    if (!group[m.pos]) group[m.pos] = [];
    if (!group[m.pos].includes(m.meaning)) group[m.pos].push(m.meaning);
  });
  return Object.keys(group).map(pos => `<span class="pos">${pos}</span> ${group[pos].join(", ")}`).join(" | ");
}

function startQuiz(count) {
  if (remainingWords.length === 0) {
    alert("ëª¨ë“  ë‹¨ì–´ë¥¼ í•™ìŠµí–ˆìŠµë‹ˆë‹¤! ë‹¤ì‹œ ì²˜ìŒë¶€í„° ë¦¬ëª¨ë¸ë§í•©ë‹ˆë‹¤.");
    remainingWords = [...WORDS];
    totalSolved = 0;
    totalTarget = 0;
  }

  // ì´ë²ˆì— ì¶”ê°€ë¡œ ê°€ì ¸ì˜¬ ê°œìˆ˜
  let actualCount = Math.min(count, remainingWords.length);
  
  // 1. ë‚¨ì€ ë‹¨ì–´ì—ì„œ ìƒˆë¡œ ë½‘ê¸°
  let tempShuffled = [...remainingWords].sort(() => Math.random() - 0.5);
  let newSet = tempShuffled.slice(0, actualCount);

  // 2. ëˆ„ì  ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€
  quizList = [...quizList, ...newSet];
  totalTarget += actualCount; // ì „ì²´ ëª©í‘œì¹˜ ì¦ê°€

  // 3. ì£¼ë¨¸ë‹ˆì—ì„œ ì œê±°
  const newWords = newSet.map(q => q.word);
  remainingWords = remainingWords.filter(w => !newWords.includes(w.word));

  // 4. ê¸°ì¡´ ì˜¤ë‹µ/ì •ë‹µ ë…¸íŠ¸ ìœ ì§€ ì—¬ë¶€ (ìƒˆë¡œ ì‹œì‘í•  ë•Œë§Œ ë¹„ìš°ê³  ì‹¶ë‹¤ë©´ ì´ ë¡œì§ì„ ì¡°ì ˆ)
  // ì—¬ê¸°ì„œëŠ” ë²„íŠ¼ ëˆ„ë¥¼ ë•Œë§ˆë‹¤ ë…¸íŠ¸ë¥¼ ì´ˆê¸°í™”í•˜ì§€ ì•Šê³  ì´ì–´ì„œ ìŒ“ì´ê²Œ ë‘ì—ˆìŠµë‹ˆë‹¤.

  updateUI();
  // í˜„ì¬ ë¬¸ì œê°€ ì§„í–‰ ì¤‘ì´ ì•„ë‹ ë•Œë§Œ ìƒˆë¡œ ë¡œë“œ (ëë‚œ ìƒíƒœì—ì„œ ì¶”ê°€ ë²„íŠ¼ ëˆŒë €ì„ ë•Œ ëŒ€ì‘)
  if (currentIndex >= quizList.length - actualCount) {
    loadQuiz();
  }
}

function loadQuiz() {
  if (currentIndex >= quizList.length) {
    document.getElementById("quizWord").innerText = "ğŸ‰ í˜„ì¬ ì„¸íŠ¸ ì™„ë£Œ!";
    document.getElementById("quizChoices").innerHTML = "<p style='text-align:center;'>ì¶”ê°€ ë²„íŠ¼ì„ ëˆŒëŸ¬ í•™ìŠµì„ ì´ì–´ê°€ì„¸ìš”.</p>";
    return;
  }

  const q = quizList[currentIndex];
  const correctHTML = getCombinedMeanings(q.meanings);

  const wrongs = [...WORDS].filter(w => w.word !== q.word)
    .sort(() => Math.random() - 0.5)
    .slice(0, 3)
    .map(w => getCombinedMeanings(w.meanings));

  const choices = [...wrongs, correctHTML].sort(() => Math.random() - 0.5);

  document.getElementById("quizWord").innerText = q.word;
  const choicesDiv = document.getElementById("quizChoices");
  choicesDiv.innerHTML = "";

  choices.forEach(html => {
    const btn = document.createElement("button");
    btn.className = "choice-btn";
    btn.innerHTML = html;
    btn.onclick = () => submitAnswer(q.word, html, correctHTML, html === correctHTML);
    choicesDiv.appendChild(btn);
  });

  updateProgressDisplay();
}

function submitAnswer(word, userHTML, correctHTML, isCorrect) {
  const div = document.createElement("div");
  div.style.padding = "8px";
  div.style.borderBottom = "1px solid #eee";
  div.style.color = isCorrect ? "#27ae60" : "#e74c3c";
  div.innerHTML = (isCorrect ? "âœ… " : "âŒ ") + `<b>${word}</b> : ` + correctHTML;

  const target = isCorrect ? "correctNote" : "wrongNote";
  document.getElementById(target).prepend(div);

  currentIndex++;
  totalSolved++; // ì „ì²´ ëˆ„ì  ì¹´ìš´íŠ¸ ì¦ê°€
  loadQuiz();
}

function updateUI() {
  document.getElementById("remaining-count").innerText = remainingWords.length;
}

function updateProgressDisplay() {
    // 'í˜„ì¬ í‘¼ ê°œìˆ˜ / ì „ì²´ ëª©í‘œ ê°œìˆ˜' í‘œì‹œ
    document.getElementById("progress").innerText = `ì§„í–‰: ${currentIndex} / ${totalTarget}`;
}

window.onload = function () {
  fetch("words.json")
    .then(res => res.json())
    .then(data => {
      WORDS = data;
      remainingWords = [...data];
      document.getElementById("total-count").innerText = WORDS.length;
      updateUI();
    });
};
</script>
</head>
<body>

<h2>ğŸ“˜ ì˜ë‹¨ì–´ ë§ˆìŠ¤í„° í€´ì¦ˆ</h2>

<div style="background: #fff; border: 1px solid #ddd; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
  <strong>ë¯¸í•™ìŠµ ë‹¨ì–´: <span id="remaining-count" style="color: #e74c3c;">0</span></strong> / ì „ì²´: <span id="total-count">0</span>
</div>

<p>
  í•™ìŠµí•  ê°œìˆ˜ ì¶”ê°€: 
  <button class="count-btn" onclick="startQuiz(50)">+ 50ê°œ</button>
  <button class="count-btn" onclick="startQuiz(100)">+ 100ê°œ</button>
  <button class="count-btn" onclick="startQuiz(150)">+ 150ê°œ</button>
  <button class="count-btn" onclick="startQuiz(300)">ì „ì²´</button>
</p>

<p id="progress">ì§„í–‰: 0 / 0</p>

<div class="quiz-box">
  <span id="quizWord">ê°œìˆ˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹œì‘í•˜ì„¸ìš”</span>
  <br>
  <div id="quizChoices"></div>
</div>

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
  <div><h3>âœ… ì •ë‹µë…¸íŠ¸</h3><div id="correctNote" class="note-container"></div></div>
  <div><h3>âŒ ì˜¤ë‹µë…¸íŠ¸</h3><div id="wrongNote" class="note-container"></div></div>
</div>

</body>
</html>
