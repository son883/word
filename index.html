<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>μλ‹¨μ–΄ λ§μ¤ν„° ν€΄μ¦</title>

<style>
  body { font-family: 'Malgun Gothic', sans-serif; padding: 20px; line-height: 1.6; background-color: #f9f9f9; }
  .pos { color: #0070c0; font-weight: bold; margin-right: 4px; }
  .choice-btn { 
    margin-bottom: 8px; padding: 12px 20px; width: 100%; text-align: left; 
    cursor: pointer; background-color: #fff; border: 1px solid #ddd; border-radius: 5px;
  }
  .choice-btn:hover { background-color: #f0f7ff; border-color: #0070c0; }
  .quiz-box { border: 2px solid #0070c0; padding: 20px; border-radius: 10px; background-color: #fff; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
  #quizWord { font-size: 1.5rem; font-weight: bold; }
  .note-container { border: 1px solid #ccc; padding: 15px; margin-top: 10px; max-height: 300px; overflow-y: auto; background-color: #fff; }
  button.count-btn { padding: 8px 15px; margin-right: 5px; cursor: pointer; border-radius: 4px; border: 1px solid #0070c0; background: #fff; color: #0070c0; font-weight: bold; }
  button.count-btn:hover { background: #0070c0; color: #fff; }
</style>

<script>
let WORDS = [];
let remainingWords = [];
let quizList = [];
let currentIndex = 0;
let maxCount = 0;

/* -------------------------------------------
   [ν•µμ‹¬] ν’μ‚¬ ν†µν•© λ΅μ§: κ°™μ€ ν’μ‚¬λΌλ¦¬ λ¬¶μ–΄μ£Όλ” ν•¨μ
   ------------------------------------------- */
function getCombinedMeanings(meanings) {
  const group = {};
  meanings.forEach(m => {
    if (!group[m.pos]) group[m.pos] = [];
    group[m.pos].push(m.meaning);
  });
  
  // κ²°κ³Ό: "λ…μ‚¬ λ»1, λ»2 | λ™μ‚¬ λ»3" ν•νƒμ λ¬Έμμ—΄ λ°ν™
  return Object.keys(group).map(pos => {
    return `<span class="pos">${pos}</span> ${group[pos].join(", ")}`;
  }).join(" | ");
}

function startQuiz(count) {
  if (remainingWords.length === 0) {
    alert("λ¨λ“  λ‹¨μ–΄λ¥Ό ν•™μµν–μµλ‹λ‹¤! λ‹¤μ‹ μ²μλ¶€ν„° μ‹μ‘ν•©λ‹λ‹¤.");
    remainingWords = [...WORDS];
  }
  maxCount = Math.min(count, remainingWords.length);
  let tempShuffled = [...remainingWords].sort(() => Math.random() - 0.5);
  quizList = tempShuffled.slice(0, maxCount);

  const quizWordTexts = quizList.map(q => q.word);
  remainingWords = remainingWords.filter(w => !quizWordTexts.includes(w.word));

  currentIndex = 0;
  document.getElementById("correctNote").innerHTML = "";
  document.getElementById("wrongNote").innerHTML = "";
  updateUI();
  loadQuiz();
}

function loadQuiz() {
  if (currentIndex >= quizList.length) {
    document.getElementById("quizWord").innerText = "π‰ μ„ΈνΈ μΆ…λ£!";
    document.getElementById("quizChoices").innerHTML = "";
    return;
  }

  const q = quizList[currentIndex];
  const correctHTML = getCombinedMeanings(q.meanings);

  // μ¤λ‹µ 3κ° μ¶”μ¶
  const wrongs = [...WORDS].filter(w => w.word !== q.word)
    .sort(() => Math.random() - 0.5)
    .slice(0, 3)
    .map(w => getCombinedMeanings(w.meanings));

  const choices = [...wrongs, correctHTML].sort(() => Math.random() - 0.5);

  document.getElementById("quizWord").innerText = q.word;
  const choicesDiv = document.getElementById("quizChoices");
  choicesDiv.innerHTML = "";

  choices.forEach(html => {
    const btn = document.createElement("button");
    btn.className = "choice-btn";
    btn.innerHTML = html;
    btn.onclick = () => {
      const isCorrect = (html === correctHTML);
      submitAnswer(q.word, html, correctHTML, isCorrect);
    };
    choicesDiv.appendChild(btn);
  });

  document.getElementById("progress").innerText = `μ§„ν–‰: ${currentIndex + 1} / ${maxCount}`;
}

function submitAnswer(word, userHTML, correctHTML, isCorrect) {
  const div = document.createElement("div");
  div.style.color = isCorrect ? "green" : "red";
  div.style.borderBottom = "1px solid #eee";
  div.style.marginBottom = "5px";
  div.innerHTML = (isCorrect ? "β… " : "β ") + `<b>${word}</b> : ` + correctHTML;

  const target = isCorrect ? "correctNote" : "wrongNote";
  document.getElementById(target).prepend(div);

  currentIndex++;
  loadQuiz();
}

function updateUI() {
  document.getElementById("remaining-count").innerText = remainingWords.length;
}

window.onload = function () {
  fetch("words.json")
    .then(res => res.json())
    .then(data => {
      WORDS = data;
      remainingWords = [...data];
      document.getElementById("total-count").innerText = WORDS.length;
      updateUI();
    });
};
</script>
</head>
<body>

<h2>π“ μλ‹¨μ–΄ ν€΄μ¦ (ν’μ‚¬ ν†µν•©ν•)</h2>

<div style="background: #eee; padding: 10px; border-radius: 5px; margin-bottom: 15px;">
  <strong>λ―Έν•™μµ: <span id="remaining-count">0</span></strong> / μ „μ²΄: <span id="total-count">0</span>
</div>

<p>
  <button class="count-btn" onclick="startQuiz(50)">50κ°</button>
  <button class="count-btn" onclick="startQuiz(100)">100κ°</button>
  <button class="count-btn" onclick="startQuiz(300)">μ „μ²΄</button>
</p>

<p id="progress">μ§„ν–‰: 0 / 0</p>

<div class="quiz-box">
  <p><b>λ‹¨μ–΄:</b> <span id="quizWord">κ°μλ¥Ό μ„ νƒν•μ„Έμ”</span></p>
  <div id="quizChoices"></div>
</div>

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
  <div><h3>β… μ •λ‹µλ…ΈνΈ</h3><div id="correctNote" class="note-container"></div></div>
  <div><h3>β μ¤λ‹µλ…ΈνΈ</h3><div id="wrongNote" class="note-container"></div></div>
</div>

</body>
</html>
