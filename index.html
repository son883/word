<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Word Quiz</title>

<style>
  body { font-family: Arial, sans-serif; }
  .pos { color: #0070c0; font-weight: bold; }
  .choice-btn { margin-bottom: 6px; padding: 6px 12px; }
</style>

<script>
/* =========================
   ì „ì—­ ë³€ìˆ˜
   ========================= */
let WORDS = [];
const COLOR_POS_LIST = ["ëª…ì‚¬", "ë™ì‚¬", "í˜•ìš©ì‚¬", "ë¶€ì‚¬", "í‘œí˜„", "ìˆ™ì–´"];
let quizList = [];
let currentIndex = 0;
let maxCount = 0;

/* =========================
   ìœ í‹¸
   ========================= */
function shuffle(arr) {
  return [...arr].sort(() => Math.random() - 0.5);
}

function buildFullMeaning(meanings) {
  return meanings.map(m => `${m.pos} ${m.meaning}`).join(" | ");
}

function renderFullMeaning(container, full) {
  container.innerHTML = "";
  const parts = full.split("|");

  parts.forEach((raw, idx) => {
    const part = raw.trim();
    const spaceIdx = part.indexOf(" ");

    let pos = "";
    let meaning = part;

    if (spaceIdx > 0) {
      pos = part.substring(0, spaceIdx);
      meaning = part.substring(spaceIdx + 1);
    }

    if (COLOR_POS_LIST.includes(pos)) {
      const span = document.createElement("span");
      span.className = "pos";
      span.innerText = pos;
      container.appendChild(span);
      container.appendChild(document.createTextNode(" "));
    } else if (pos) {
      container.appendChild(document.createTextNode(pos + " "));
    }

    container.appendChild(document.createTextNode(meaning));

    if (idx < parts.length - 1) {
      container.appendChild(document.createTextNode(" | "));
    }
  });
}

/* =========================
   í€´ì¦ˆ ë¡œì§
   ========================= */
function startQuiz(count) {
  maxCount = Math.min(count, WORDS.length);
  quizList = shuffle(WORDS).slice(0, maxCount);
  currentIndex = 0;

  document.getElementById("correctNote").innerHTML = "";
  document.getElementById("wrongNote").innerHTML = "";

  loadQuiz();
}

function loadQuiz() {
  if (currentIndex >= quizList.length) {
    document.getElementById("quizWord").innerText = "ğŸ‰ ëª¨ë“  ë¬¸ì œê°€ ëë‚¬ìŠµë‹ˆë‹¤!";
    document.getElementById("quizChoices").innerHTML = "";
    document.getElementById("progress").innerText =
      `ì§„í–‰: ${maxCount} / ${maxCount}`;
    return;
  }

  const q = quizList[currentIndex];
  const correct = buildFullMeaning(q.meanings);

  const wrongs = shuffle(
    WORDS.filter(w => w.word !== q.word)
  ).slice(0, 3).map(w => buildFullMeaning(w.meanings));

  const choices = shuffle([...wrongs, correct]);

  document.getElementById("quizWord").innerText = q.word;
  document.getElementById("correctAnswer").value = correct;

  const choicesDiv = document.getElementById("quizChoices");
  choicesDiv.innerHTML = "";

  choices.forEach(c => {
    const btn = document.createElement("button");
    btn.className = "choice-btn";
    renderFullMeaning(btn, c);
    btn.onclick = () => submitAnswer(q.word, c, correct);
    choicesDiv.appendChild(btn);
    choicesDiv.appendChild(document.createElement("br"));
  });

  document.getElementById("progress").innerText =
    `ì§„í–‰: ${currentIndex} / ${maxCount}`;
}

function submitAnswer(word, user, correct) {
  const div = document.createElement("div");
  div.appendChild(
    document.createTextNode((user === correct ? "âœ… " : "âŒ ") + word + " : ")
  );

  const span = document.createElement("span");
  renderFullMeaning(span, correct);
  div.appendChild(span);

  if (user === correct)
    document.getElementById("correctNote").appendChild(div);
  else
    document.getElementById("wrongNote").appendChild(div);

  currentIndex++;
  loadQuiz();
}

/* =========================
   JSON ë¡œë“œ
   ========================= */
window.onload = function () {
  fetch("words.json")
    .then(res => res.json())
    .then(data => {
      WORDS = data;
      document.getElementById("quizWord").innerText =
        "ë¬¸ì œ ê°œìˆ˜ë¥¼ ì„ íƒí•˜ì„¸ìš”";
    })
    .catch(err => {
      alert("words.jsonì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
      console.error(err);
    });
};
</script>
</head>

<body>

<h2>ğŸ“˜ ì˜ë‹¨ì–´ í€´ì¦ˆ</h2>

<p>
  ë¬¸ì œ ê°œìˆ˜:
  <button onclick="startQuiz(50)">5</button>
  <button onclick="startQuiz(100)">10</button>
  <button onclick="startQuiz(150)">30</button>
  <button onclick="startQuiz(300)">30</button>

</p>

<p id="progress">ì§„í–‰: 0 / 0</p>

<div style="border:1px solid #ccc; padding:15px; margin-bottom:15px;">
  <p><b>ë‹¨ì–´:</b> <span id="quizWord">ë¡œë”© ì¤‘...</span></p>
  <input type="hidden" id="correctAnswer">
  <br><br>
  <div id="quizChoices"></div>
</div>

<h3>âœ… ì •ë‹µë…¸íŠ¸</h3>
<div id="correctNote" style="border:1px solid green; padding:10px;"></div>

<h3>âŒ ì˜¤ë‹µë…¸íŠ¸</h3>
<div id="wrongNote" style="border:1px solid red; padding:10px;"></div>

</body>
</html>
