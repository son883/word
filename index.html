<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì˜ë‹¨ì–´ ë§ˆìŠ¤í„° í€´ì¦ˆ</title>

<style>
  body { font-family: 'Malgun Gothic', sans-serif; padding: 20px; line-height: 1.6; background-color: #f9f9f9; }
  h2 { color: #333; }
  .pos { color: #0070c0; font-weight: bold; }
  .choice-btn { 
    margin-bottom: 8px; 
    padding: 10px 20px; 
    width: 100%; 
    text-align: left; 
    cursor: pointer;
    background-color: #fff;
    border: 1px solid #ddd;
    border-radius: 5px;
    transition: background 0.2s;
  }
  .choice-btn:hover { background-color: #f0f7ff; border-color: #0070c0; }
  #progress { font-weight: bold; color: #555; margin-bottom: 10px; }
  #remaining-count { color: #e74c3c; }
  .note-container { 
    border: 1px solid #ccc; 
    padding: 15px; 
    margin-top: 20px; 
    max-height: 300px; 
    overflow-y: auto; 
    background-color: #fff;
  }
  .correct-item { color: green; margin-bottom: 5px; border-bottom: 1px solid #eee; }
  .wrong-item { color: red; margin-bottom: 5px; border-bottom: 1px solid #eee; }
  .quiz-box { 
    border: 2px solid #0070c0; 
    padding: 20px; 
    border-radius: 10px; 
    background-color: #fff;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
  }
  #quizWord { font-size: 1.5rem; font-weight: bold; color: #2c3e50; }
  button.count-btn {
    padding: 8px 15px;
    margin-right: 5px;
    cursor: pointer;
    border-radius: 4px;
    border: 1px solid #0070c0;
    background: #fff;
    color: #0070c0;
    font-weight: bold;
  }
  button.count-btn:hover { background: #0070c0; color: #fff; }
</style>

<script>
/* =========================
   ì „ì—­ ë³€ìˆ˜
   ========================= */
let WORDS = [];         // ì „ì²´ ì›ë³¸ ë¦¬ìŠ¤íŠ¸
let remainingWords = []; // ì•„ì§ í•œ ë²ˆë„ ì•ˆ ë‚˜ì˜¨ ë‹¨ì–´ë“¤ (ì¤‘ë³µ ë°©ì§€ìš©)
let quizList = [];       // í˜„ì¬ ì„¸íŠ¸(50ê°œ ë“±)ì˜ ë¬¸ì œë“¤
let currentIndex = 0;
let maxCount = 0;

const COLOR_POS_LIST = ["ëª…ì‚¬", "ë™ì‚¬", "í˜•ìš©ì‚¬", "ë¶€ì‚¬", "í‘œí˜„", "ìˆ™ì–´"];

/* =========================
   ìœ í‹¸ í•¨ìˆ˜
   ========================= */
function shuffle(arr) {
  return [...arr].sort(() => Math.random() - 0.5);
}

function buildFullMeaning(meanings) {
  return meanings.map(m => `${m.pos} ${m.meaning}`).join(" | ");
}

function renderFullMeaning(container, full) {
  container.innerHTML = "";
  const parts = full.split("|");

  parts.forEach((raw, idx) => {
    const part = raw.trim();
    const spaceIdx = part.indexOf(" ");

    let pos = "";
    let meaning = part;

    if (spaceIdx > 0) {
      pos = part.substring(0, spaceIdx);
      meaning = part.substring(spaceIdx + 1);
    }

    if (COLOR_POS_LIST.includes(pos)) {
      const span = document.createElement("span");
      span.className = "pos";
      span.innerText = pos;
      container.appendChild(span);
      container.appendChild(document.createTextNode(" "));
    } else if (pos) {
      container.appendChild(document.createTextNode(pos + " "));
    }

    container.appendChild(document.createTextNode(meaning));

    if (idx < parts.length - 1) {
      container.appendChild(document.createTextNode(" | "));
    }
  });
}

/* =========================
   í€´ì¦ˆ ë¡œì§ (í•µì‹¬: ì¤‘ë³µ ë°©ì§€)
   ========================= */
function startQuiz(count) {
  // ë‚¨ì€ ë‹¨ì–´ê°€ í•˜ë‚˜ë„ ì—†ìœ¼ë©´ ì „ì²´ ë¦¬ì…‹
  if (remainingWords.length === 0) {
    alert("ëª¨ë“  ë‹¨ì–´ë¥¼ í•™ìŠµí–ˆìŠµë‹ˆë‹¤! ë‹¤ì‹œ ì²˜ìŒë¶€í„° ë¦¬ìŠ¤íŠ¸ë¥¼ ì±„ì›ë‹ˆë‹¤.");
    remainingWords = [...WORDS];
  }

  // ì´ë²ˆ íŒì— ë‚¼ ê°œìˆ˜ ê²°ì •
  maxCount = Math.min(count, remainingWords.length);
  
  // 1. ë‚¨ì€ ë‹¨ì–´ë¥¼ ì„ì–´ì„œ ìš”ì²­í•œ ê°œìˆ˜ë§Œí¼ ì¶”ì¶œ
  let tempShuffled = shuffle(remainingWords);
  quizList = tempShuffled.slice(0, maxCount);

  // 2. í•µì‹¬: ì¶”ì¶œëœ ë‹¨ì–´ë“¤ì„ 'ë‚¨ì€ ë‹¨ì–´ ì£¼ë¨¸ë‹ˆ'ì—ì„œ ì˜êµ¬ ì œê±°
  const quizWordTexts = quizList.map(q => q.word);
  remainingWords = remainingWords.filter(w => !quizWordTexts.includes(w.word));

  currentIndex = 0;
  document.getElementById("correctNote").innerHTML = "";
  document.getElementById("wrongNote").innerHTML = "";
  
  updateRemainingUI();
  loadQuiz();
}

function loadQuiz() {
  if (currentIndex >= quizList.length) {
    document.getElementById("quizWord").innerText = "ğŸ‰ ì´ë²ˆ ì„¸íŠ¸ ì™„ë£Œ!";
    document.getElementById("quizChoices").innerHTML = "<p>ìœ„ì˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë‹¤ìŒ ì„¸íŠ¸ë¥¼ ì‹œì‘í•˜ì„¸ìš”.</p>";
    document.getElementById("progress").innerText = `ì§„í–‰: ${maxCount} / ${maxCount}`;
    return;
  }

  const q = quizList[currentIndex];
  const correct = buildFullMeaning(q.meanings);

  // ì˜¤ë‹µ ë³´ê¸°ëŠ” ì „ì²´ WORDS(300ê°œ)ì—ì„œ ë¬´ì‘ìœ„ë¡œ ì¶”ì¶œ
  const wrongs = shuffle(
    WORDS.filter(w => w.word !== q.word)
  ).slice(0, 3).map(w => buildFullMeaning(w.meanings));

  const choices = shuffle([...wrongs, correct]);

  document.getElementById("quizWord").innerText = q.word;
  document.getElementById("correctAnswer").value = correct;

  const choicesDiv = document.getElementById("quizChoices");
  choicesDiv.innerHTML = "";

  choices.forEach(c => {
    const btn = document.createElement("button");
    btn.className = "choice-btn";
    renderFullMeaning(btn, c);
    btn.onclick = () => submitAnswer(q.word, c, correct);
    choicesDiv.appendChild(btn);
  });

  document.getElementById("progress").innerText = `ì§„í–‰: ${currentIndex + 1} / ${maxCount}`;
}

function submitAnswer(word, user, correct) {
  const div = document.createElement("div");
  div.className = (user === correct) ? "correct-item" : "wrong-item";
  div.appendChild(
    document.createTextNode((user === correct ? "âœ… " : "âŒ ") + word + " : ")
  );

  const span = document.createElement("span");
  renderFullMeaning(span, correct);
  div.appendChild(span);

  if (user === correct)
    document.getElementById("correctNote").prepend(div); // ìµœì‹ ì´ ìœ„ë¡œ ì˜¤ê²Œ prepend
  else
    document.getElementById("wrongNote").prepend(div);

  currentIndex++;
  loadQuiz();
}

function updateRemainingUI() {
  document.getElementById("remaining-count").innerText = remainingWords.length;
}

/* =========================
   JSON ë¡œë”©
   ========================= */
window.onload = function () {
  fetch("words.json")
    .then(res => res.json())
    .then(data => {
      WORDS = data;
      remainingWords = [...data]; // ì²˜ìŒì— ì „ì²´ ë³µì‚¬
      document.getElementById("quizWord").innerText = "ë¬¸ì œ ê°œìˆ˜ë¥¼ ì„ íƒí•˜ì„¸ìš”";
      updateRemainingUI();
    })
    .catch(err => {
      alert("words.json íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê²½ë¡œë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.");
      console.error(err);
    });
};
</script>
</head>

<body>

<h2>ğŸ“˜ ì˜ë‹¨ì–´ ë§ˆìŠ¤í„° í€´ì¦ˆ</h2>

<div style="margin-bottom: 20px; background: #eee; padding: 10px; border-radius: 5px;">
  <strong>ë¯¸í•™ìŠµ ë‹¨ì–´: <span id="remaining-count">0</span>ê°œ</strong> / ì „ì²´: <span id="total-count">...</span>ê°œ
  <br>
  <small>* í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ë©´ í•™ìŠµ ê¸°ë¡ì´ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.</small>
</div>

<p>
  ìƒˆ ì„¸íŠ¸ ì‹œì‘: 
  <button class="count-btn" onclick="startQuiz(50)">50ê°œ</button>
  <button class="count-btn" onclick="startQuiz(100)">100ê°œ</button>
  <button class="count-btn" onclick="startQuiz(150)">150ê°œ</button>
  <button class="count-btn" onclick="startQuiz(300)">ì „ì²´</button>
</p>

<p id="progress">ì§„í–‰: 0 / 0</p>

<div class="quiz-box">
  <p><b>ë‹¨ì–´:</b> <span id="quizWord">ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</span></p>
  <input type="hidden" id="correctAnswer">
  <div id="quizChoices"></div>
</div>

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
  <div>
    <h3>âœ… ì •ë‹µë…¸íŠ¸</h3>
    <div id="correctNote" class="note-container"></div>
  </div>
  <div>
    <h3>âŒ ì˜¤ë‹µë…¸íŠ¸</h3>
    <div id="wrongNote" class="note-container"></div>
  </div>
</div>

<script>
  // ì „ì²´ ê°œìˆ˜ í‘œì‹œìš© ìŠ¤í¬ë¦½íŠ¸ ë³´ì¡°
  window.addEventListener('load', () => {
    setTimeout(() => {
      document.getElementById("total-count").innerText = WORDS.length;
      updateRemainingUI();
    }, 500);
  });
</script>

</body>
</html>
